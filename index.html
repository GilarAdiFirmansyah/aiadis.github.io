<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuckDuckGo Search + AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Simple Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            background-color: #1c1c1c;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .search-container {
            transition: all 0.3s ease;
        }
        .search-container:focus-within {
            box-shadow: 0 0 0 2px rgba(222, 88, 51, 0.5);
            transform: scale(1.02);
        }
        /* Custom scrollbar for AI results */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #de5833;
        }
        .prose p {
            margin-bottom: 0.5em;
        }
        .prose ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin-bottom: 0.5em;
        }
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid #de5833;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-center text-white overflow-hidden relative">

    <div class="absolute inset-0 z-0 opacity-10">
        <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path d="M0 100 C 20 0 50 0 100 100 Z" fill="#de5833" />
        </svg>
    </div>

    <main class="z-10 w-full max-w-2xl px-4 flex flex-col items-center gap-6 h-full justify-center transition-all duration-500" id="mainContainer">
        <div class="flex flex-col items-center gap-4 transition-all duration-500" id="logoContainer">
            <div class="relative w-24 h-24 bg-[#de5833] rounded-full flex items-center justify-center shadow-lg mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="60" height="60">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                </svg>
            </div>
            <h1 class="text-3xl font-bold tracking-wide">DuckDuckGo <span class="text-[#de5833] text-lg align-top ml-1">AI</span></h1>
        </div>

        <form id="searchForm" class="w-full relative search-container bg-[#2d2d2d] rounded-full flex items-center shadow-2xl border border-gray-700 z-20">
            <div class="pl-6 text-gray-400">
                <i data-lucide="search" class="w-5 h-5"></i>
            </div>
            <input 
                type="text" 
                id="searchInput"
                class="w-full bg-transparent border-none outline-none text-white px-4 py-4 text-lg placeholder-gray-500 rounded-full"
                placeholder="Search privately or ask AI..."
                autocomplete="off"
                autofocus
            >
            <div class="flex items-center pr-2 gap-2">
                 <button 
                    type="button" 
                    id="clearBtn" 
                    class="p-2 text-gray-400 hover:text-white transition-colors hidden"
                    onclick="clearSearch()"
                >
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
        </form>

        <!-- Quick Actions -->
        <div class="flex flex-wrap justify-center gap-3 mt-2 text-sm text-gray-400" id="quickActions">
            <button onclick="quickSearch('News')" class="hover:text-[#de5833] transition-colors bg-[#2d2d2d] px-3 py-1 rounded-full border border-gray-700">News</button>
            <button onclick="quickSearch('Images')" class="hover:text-[#de5833] transition-colors bg-[#2d2d2d] px-3 py-1 rounded-full border border-gray-700">Images</button>
            <button onclick="askGemini('answer')" class="flex items-center gap-1 hover:text-yellow-400 text-yellow-500/90 transition-colors bg-[#2d2d2d] px-3 py-1 rounded-full border border-yellow-500/30">
                <i data-lucide="sparkles" class="w-3 h-3"></i> Instant Answer
            </button>
            <button onclick="askGemini('explore')" class="flex items-center gap-1 hover:text-purple-400 text-purple-500/90 transition-colors bg-[#2d2d2d] px-3 py-1 rounded-full border border-purple-500/30">
                <i data-lucide="telescope" class="w-3 h-3"></i> Deep Dive
            </button>
        </div>

        <!-- AI Result Container -->
        <div id="aiResultContainer" class="hidden w-full bg-[#2d2d2d] rounded-2xl border border-gray-700 p-6 shadow-2xl mt-4 max-h-[40vh] overflow-y-auto custom-scroll transition-all duration-300 transform opacity-0 scale-95">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-2 text-[#de5833] font-semibold">
                    <i data-lucide="bot" class="w-5 h-5"></i>
                    <span id="aiTitle">AI Response</span>
                </div>
                <button onclick="closeAi()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            
            <div id="aiLoading" class="hidden flex flex-col items-center justify-center py-8 gap-3">
                <div class="loader"></div>
                <span class="text-sm text-gray-400 animate-pulse">Thinking...</span>
            </div>

            <div id="aiContent" class="prose prose-invert prose-sm max-w-none text-gray-200 leading-relaxed">
                <!-- Content goes here -->
            </div>
            
            <div id="aiFooter" class="mt-4 pt-4 border-t border-gray-700 flex justify-end">
                <button onclick="continueSearch()" class="text-xs text-gray-400 hover:text-white flex items-center gap-1">
                    Continue to DuckDuckGo <i data-lucide="arrow-right" class="w-3 h-3"></i>
                </button>
            </div>
        </div>

    </main>

    <footer class="absolute bottom-6 text-gray-500 text-xs text-center">
        <p>Privacy Simplified. AI Enhanced.</p>
    </footer>

    <script>
        lucide.createIcons();
        const apiKey = ""; // System will inject the key here
        
        const form = document.getElementById('searchForm');
        const input = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearBtn');
        const aiContainer = document.getElementById('aiResultContainer');
        const aiContent = document.getElementById('aiContent');
        const aiLoading = document.getElementById('aiLoading');
        const aiTitle = document.getElementById('aiTitle');
        const mainContainer = document.getElementById('mainContainer');
        const logoContainer = document.getElementById('logoContainer');

        input.addEventListener('input', () => {
            if (input.value.length > 0) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
        });

        function clearSearch() {
            input.value = '';
            input.focus();
            clearBtn.classList.add('hidden');
            closeAi();
        }

        function performSearch(query) {
            if (!query.trim()) return;
            const encodedQuery = encodeURIComponent(query);
            window.location.href = `https://duckduckgo.com/?q=${encodedQuery}`;
        }

        function continueSearch() {
            performSearch(input.value);
        }

        function quickSearch(type) {
            const currentVal = input.value.trim();
            if (currentVal) {
                performSearch(`${currentVal} ${type}`);
            } else {
                input.placeholder = `Search for ${type}...`;
                input.focus();
            }
        }

        function closeAi() {
            aiContainer.classList.add('hidden', 'opacity-0', 'scale-95');
            // Reset layout
            mainContainer.classList.add('justify-center');
            mainContainer.classList.remove('pt-12');
            logoContainer.classList.remove('scale-75');
            input.focus();
        }

        async function askGemini(mode) {
            const query = input.value.trim();
            if (!query) {
                input.placeholder = "Please enter a topic first...";
                input.focus();
                return;
            }

            // UI Transitions
            mainContainer.classList.remove('justify-center');
            mainContainer.classList.add('pt-12'); // Move to top
            logoContainer.classList.add('scale-75'); // Shrink logo
            
            aiContainer.classList.remove('hidden');
            // Small timeout to allow display:block to apply before opacity transition
            setTimeout(() => {
                aiContainer.classList.remove('opacity-0', 'scale-95');
            }, 10);

            aiContent.innerHTML = '';
            aiLoading.classList.remove('hidden');
            document.getElementById('aiFooter').classList.add('hidden');
            
            let systemPrompt = "";
            if (mode === 'answer') {
                aiTitle.innerText = "Instant Answer";
                systemPrompt = "You are a concise and helpful search assistant. Provide a direct, factual answer or summary for the user's query. Keep it under 150 words if possible. Use Markdown formatting.";
            } else {
                aiTitle.innerText = "Deep Dive Topics";
                systemPrompt = "You are a research expert. The user is searching for a topic. Suggest 5-7 distinct, interesting sub-topics or specific questions related to this query that they might want to explore. Format this as a markdown bulleted list with brief explanations for why each sub-topic is interesting.";
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `${systemPrompt}\n\nUser Query: ${query}`
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('AI Service Busy');

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                
                // Parse Markdown
                aiContent.innerHTML = marked.parse(text);
                
                aiLoading.classList.add('hidden');
                document.getElementById('aiFooter').classList.remove('hidden');

            } catch (error) {
                aiLoading.classList.add('hidden');
                aiContent.innerHTML = `<p class="text-red-400">Unable to reach AI service. Please try searching on DuckDuckGo directly.</p>`;
                document.getElementById('aiFooter').classList.remove('hidden');
                console.error(error);
            }
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            performSearch(input.value);
        });
        
        // Allow Shift+Enter to trigger AI answer
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.shiftKey) {
                e.preventDefault();
                askGemini('answer');
            }
        });
    </script>
</body>
  </html>
